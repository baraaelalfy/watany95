<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>اليوم الوطني 95</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap');
    body {
      font-family: 'Tajawal', sans-serif;
      background-color: #16a34a;
      color: #fff;
      text-align: center;
    }
    .modal-overlay {
      position: fixed;
      inset: 0;
      background-color: rgba(0,0,0,0.7);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 50;
      visibility: hidden;
      opacity: 0;
      transition: visibility 0s, opacity 0.3s ease;
    }
    .modal-overlay.active {
      visibility: visible;
      opacity: 1;
    }
    .modal-content {
      background: #fff;
      color: #000;
      padding: 2rem;
      border-radius: 1rem;
      max-width: 80%;
      text-align: center;
      position: relative;
    }
    .modal-content.green-bg { background: #16a34a; color: #fff; }
    .modal-close { position: absolute; top: 1rem; right: 1rem; font-size: 2rem; font-weight: bold; cursor: pointer; }
    .modal-content.green-bg .modal-close { color: #fff; }
  </style>
</head>
<body>

  <!-- Header -->
  <header class="flex items-center justify-between px-6 py-4 bg-green-800 shadow-lg">
    <img src="https://upload.wikimedia.org/wikipedia/commons/0/0d/Flag_of_Saudi_Arabia.svg"
         alt="علم السعودية" class="w-24 h-16 md:w-32 md:h-20 rounded shadow-lg">
    <h1 class="text-4xl md:text-6xl font-bold">اليوم الوطني 95</h1>
    <img src="https://upload.wikimedia.org/wikipedia/commons/0/0d/Flag_of_Saudi_Arabia.svg"
         alt="علم السعودية" class="w-24 h-16 md:w-32 md:h-20 rounded shadow-lg">
  </header>

  <!-- Buttons -->
  <div class="flex flex-col md:flex-row justify-center items-center gap-6 mt-12">
    <button id="whatIsButton" class="bg-white text-green-700 font-bold py-4 px-10 text-xl rounded-full shadow-lg hover:bg-green-100 transition">
      ما هو اليوم الوطني
    </button>
    <button id="whenIsButton" class="bg-white text-green-700 font-bold py-4 px-10 text-xl rounded-full shadow-lg hover:bg-green-100 transition">
      متى اليوم الوطني 95
    </button>
  </div>

  <!-- Flag -->
  <div class="flex justify-center mt-12">
    <img src="https://upload.wikimedia.org/wikipedia/commons/0/0d/Flag_of_Saudi_Arabia.svg"
         alt="علم السعودية" class="w-3/4 md:w-1/2 rounded-xl shadow-2xl">
  </div>

  <!-- Entry Form -->
  <div class="bg-white p-8 mt-16 rounded-xl shadow-2xl text-black w-11/12 md:w-2/3 mx-auto">
    <h2 class="text-3xl font-bold text-green-700 mb-6">شاركنا احتفالك</h2>
    <form id="entryForm" class="space-y-4">
      <div>
        <label for="studentName" class="block text-lg font-semibold">اسم الطالب:</label>
        <input type="text" id="studentName" class="w-full p-3 border rounded-lg" placeholder="اكتب اسمك هنا" required>
      </div>
      <div>
        <label for="studentClass" class="block text-lg font-semibold">الفصل:</label>
        <input type="text" id="studentClass" class="w-full p-3 border rounded-lg" placeholder="اكتب فصلك هنا" required>
      </div>
      <div>
        <label for="studentSection" class="block text-lg font-semibold">الشعبة:</label>
        <input type="text" id="studentSection" class="w-full p-3 border rounded-lg" placeholder="اكتب شعبتك هنا" required>
      </div>
      <button type="submit" class="w-full bg-green-600 text-white text-xl font-bold py-3 rounded-full shadow-lg hover:bg-green-700 transition">إضافة</button>
    </form>
    <div id="loading" class="mt-4 text-center text-gray-500 hidden">جاري إرسال المشاركة...</div>
  </div>

  <!-- Entries -->
  <div class="mt-12 w-11/12 md:w-2/3 mx-auto">
    <h2 class="text-3xl font-bold text-center mb-6">مشاركات الطلاب</h2>
    <div id="entriesList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
  </div>

  <!-- What Modal -->
  <div id="whatModal" class="modal-overlay">
    <div class="modal-content text-lg">
      <span class="modal-close">&times;</span>
      <h3 class="text-3xl font-bold mb-4">ما هو اليوم الوطني؟</h3>
      <p>
        اليوم الوطني السعودي هو يوم توحيد المملكة العربية السعودية، ويصادف يوم 23 سبتمبر من كل عام.
        في هذا اليوم، تم توحيد مناطق المملكة تحت راية واحدة على يد الملك المؤسس عبدالعزيز بن عبدالرحمن آل سعود رحمه الله.
      </p>
    </div>
  </div>

  <!-- When Modal -->
  <div id="whenModal" class="modal-overlay">
    <div class="modal-content green-bg text-lg">
      <span class="modal-close">&times;</span>
      <h3 class="text-3xl font-bold mb-4">متى اليوم الوطني 95؟</h3>
      <p class="text-4xl font-extrabold my-8">23 سبتمبر</p>
      <p>نحتفل باليوم الوطني السعودي في الثالث والعشرين من شهر سبتمبر من كل عام.</p>
    </div>
  </div>

  <!-- Footer -->
  <footer class="mt-16 p-4 bg-white text-gray-800 text-center rounded-t-xl shadow-inner">
    <p class="font-bold text-lg">المنشئ الطالب / براء الألفي من مدرسة العباس بن عبد المطلب</p>
  </footer>

  <!-- Firebase + Modals Script -->
    <!-- Firebase + Modals Script -->
  <script type="module">
    // استيراد Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getFirestore, collection, addDoc, onSnapshot, query, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    // إعدادات Firebase الخاصة بك
    const firebaseConfig = {
      apiKey: "AIzaSyAJCZVoeBRIt_zKcWQ3th51DpNVc4p4_LU",
      authDomain: "watany95-cb974.firebaseapp.com",
      projectId: "watany95-cb974",
      storageBucket: "watany95-cb974.firebasestorage.app",
      messagingSenderId: "978450227359",
      appId: "1:978450227359:web:afbcb83c960d241b5f02aa",
      measurementId: "G-0PLS9QGRGZ"
    };

    // تهيئة Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    let userId = null;

    // التحقق من تسجيل الدخول للمستخدم (Anonymous)
    onAuthStateChanged(auth, async (user) => {
      if(user) {
        userId = user.uid;
        loadEntries();
      } else {
        await signInAnonymously(auth);
      }
    });

    // المرجع لمجموعة المشاركات
    const entriesCollectionRef = collection(db, "nationalDayEntries");
    const entriesListDiv = document.getElementById('entriesList');

    // تحميل المشاركات وعرضها
    const loadEntries = () => {
      const q = query(entriesCollectionRef);
      onSnapshot(q, snapshot => {
        const entries = [];
        snapshot.forEach(doc => entries.push({id: doc.id, ...doc.data()}));
        // ترتيب حسب الأحدث
        entries.sort((a,b) => b?.createdAt?.seconds - a?.createdAt?.seconds);
        entriesListDiv.innerHTML = '';
        if(entries.length){
          entries.forEach(data => {
            const div = document.createElement('div');
            div.className='bg-white text-black p-6 rounded-xl shadow-lg';
            div.innerHTML = `
              <p class="font-bold text-xl">${data.name}</p>
              <p><strong>الفصل:</strong> ${data.studentClass}</p>
              <p><strong>الشعبة:</strong> ${data.studentSection}</p>
            `;
            entriesListDiv.appendChild(div);
          });
        } else {
          entriesListDiv.innerHTML = '<p class="text-center text-white">لا توجد مشاركات حتى الآن.</p>';
        }
      });
    };

    // إضافة مشاركة جديدة عند الضغط على زر الإرسال
    document.getElementById('entryForm').addEventListener('submit', async e => {
      e.preventDefault();
      if(!userId) return;

      // الحصول على القيم من الحقول
      const name = document.getElementById('studentName').value;
      const studentClass = document.getElementById('studentClass').value;
      const studentSection = document.getElementById('studentSection').value;

      await addDoc(entriesCollectionRef, {
        name,
        studentClass,
        studentSection,
        userId,
        createdAt: serverTimestamp()
      });

      e.target.reset(); // إعادة تعيين النموذج بعد الإرسال
    });

    // التحكم بالمودال
    const whatModal = document.getElementById('whatModal');
    const whenModal = document.getElementById('whenModal');

    document.getElementById('whatIsButton').addEventListener('click', () => {
      whatModal.classList.add('active');
    });

    document.getElementById('whenIsButton').addEventListener('click', () => {
      whenModal.classList.add('active');
    });

    document.querySelectorAll('.modal-close').forEach(btn => {
      btn.addEventListener('click', () => {
        btn.closest('.modal-overlay').classList.remove('active');
      });
    });

    document.querySelectorAll('.modal-overlay').forEach(modal => {
      modal.addEventListener('click', e => {
        if(e.target === modal) modal.classList.remove('active');
      });
    });
  </script>
</body>
</html>
